name: spy divergence agent

on:
  schedule:
    # Hourly runs at :30 ET from 9:30 through 15:30 (hourly checks during regular session)
    # Two entries cover DST/standard time differences:
    # - EDT (UTC-4): 9:30-15:30 ET = 13:30-19:30 UTC
    - cron: '30 13-19 * * 1-5'
    # - EST (UTC-5): 9:30-15:30 ET = 14:30-20:30 UTC
    - cron: '30 14-20 * * 1-5'
    # Optional single run at market close (16:00 ET). Cover both DST offsets:
    - cron: '0 20 * * 1-5'  # 16:00 ET during EDT (UTC-4)
    - cron: '0 21 * * 1-5'  # 16:00 ET during EST (UTC-5)
  workflow_dispatch: # Allows you to run it manually to test

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install yfinance requests pandas

      - name: Run Scanner
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python /projects/spy-divergence/spy-divergence.py
